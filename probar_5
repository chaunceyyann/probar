#!/bin/ksh
####################################################################################
# Program name : Progress bar implementation
# Author : Chauncey Yan
# Revision : 0.5
####################################################################################

####################################################################################
# Var init
####################################################################################
bar="##################################################"
usbar="---------------------------------------------------"
b="\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b"
####################################################################################
# Begaining point
####################################################################################
i=0
if [[ -f lastNum ]];then
	read i < lastNum
fi
if [[ $i -gt $1 ]];then
	i=0
	echo
fi
####################################################################################
# Stoping point
####################################################################################
((s=$1))
if [[ -n $2 ]];then
	((s=($1-$i)/$2+$i))
fi
((s=$s+1))
####################################################################################
# Function: update_bar
# update the bar by one index
####################################################################################
update_bar(){
	((index=($1)%101/2))
	((usindex=50-$index))
	printf $1 > lastNum
	printf "$b$1\%\t ""${bar:0:$index}""${usbar:0:$usindex}"
}
####################################################################################
# run a loop until it reachs the count
####################################################################################
until [[ $i -eq $s ]];do	
	update_bar $i
	sleep 0.02
	((i=$i+1))
done

